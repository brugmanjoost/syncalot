const AggregatorArray = require('./AggregatorArray.js');
const AggregatorCallbacks = require('./AggregatorCallbacks.js');
const AggregatorEventEmitter = require('./AggregatorEventEmitter.js');
const AggregatorMap = require('./AggregatorMap.js');
const AggregatorDummy = require('./AggregatorDummy.js');

let dummyAggregator = new AggregatorDummy();

module.exports = class Sync {

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // Function:    constructor
    //
    // Description:
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    constructor(options) {
        this.set1 = options.set1;
        this.set2 = options.set2;
        this.includeInner = options.includeInner;
        this.includeOuterLeft = options.includeOuterLeft;
        this.includeOuterRight = options.includeOuterRight;
        this.aggregator = dummyAggregator;
    }

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // Function:    asArray
    //
    // Description:
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    async asArray(options) {
        this.aggregator = new AggregatorArray(this, options);
        await this.sync();
        return this.aggregator.result;
    }

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // Function:    asCallbacks
    //
    // Description:
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    async asCallbacks(options) {
        this.aggregator = new AggregatorCallbacks(this, options);
        await this.sync();
    }

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // Function:    asEventEmitter
    //
    // Description:
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    asEventEmitter(callbacks, options) {
        return this.aggregator = new AggregatorEventEmitter(this, options);
    }

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //
    // Function:    asMap
    //
    // Description:
    //
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    async asMap(options) {
        this.aggregator = new AggregatorMap(this, options);
        await this.sync();
        return this.aggregator.result;
    }
}